#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” è¿è¡Œpre-commitæ£€æŸ¥..."

# è¿è¡Œlintæ£€æŸ¥
echo "ğŸ“ è¿è¡ŒESLint..."
npm run lint

if [ $? -ne 0 ]; then
  echo "âŒ ESLintæ£€æŸ¥å¤±è´¥ï¼Œè¯·ä¿®å¤é”™è¯¯åé‡è¯•"
  exit 1
fi

# è¿è¡Œç±»å‹æ£€æŸ¥
echo "ğŸ”§ è¿è¡ŒTypeScriptç±»å‹æ£€æŸ¥..."
npm run type-check

if [ $? -ne 0 ]; then
  echo "âŒ TypeScriptç±»å‹æ£€æŸ¥å¤±è´¥ï¼Œè¯·ä¿®å¤é”™è¯¯åé‡è¯•"
  exit 1
fi

# è¿è¡Œæ ¼å¼æ£€æŸ¥
echo "ğŸ’… æ£€æŸ¥ä»£ç æ ¼å¼..."
npm run format -- --check

if [ $? -ne 0 ]; then
  echo "âŒ ä»£ç æ ¼å¼æ£€æŸ¥å¤±è´¥ï¼Œè¯·è¿è¡Œ 'npm run format' ä¿®å¤æ ¼å¼"
  exit 1
fi

# è¿è¡Œæµ‹è¯•
echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
npm test

if [ $? -ne 0 ]; then
  echo "âŒ æµ‹è¯•å¤±è´¥ï¼Œè¯·ä¿®å¤æµ‹è¯•åé‡è¯•"
  exit 1
fi

echo "âœ… Pre-commitæ£€æŸ¥é€šè¿‡ï¼"
exit 0