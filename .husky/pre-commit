#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” è¿è¡Œpre-commitæ£€æŸ¥..."

# è¿è¡Œlintæ£€æŸ¥ï¼ˆä»…æ£€æŸ¥stagedæ–‡ä»¶ï¼‰
echo "ğŸ“ è¿è¡ŒESLint..."
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx)$' || true)

if [ -n "$STAGED_FILES" ]; then
  npx eslint --max-warnings=-1 $STAGED_FILES
  if [ $? -ne 0 ]; then
    echo "âŒ ESLintæ£€æŸ¥å¤±è´¥ï¼ˆå­˜åœ¨errorsï¼‰ï¼Œè¯·ä¿®å¤é”™è¯¯åé‡è¯•"
    exit 1
  fi
else
  echo "â„¹ï¸ æ²¡æœ‰stagedçš„TypeScriptæ–‡ä»¶éœ€è¦æ£€æŸ¥"
fi

# Skip type-check, format and test for now (they check entire project)
# Uncomment these when all files pass
# echo "ğŸ”§ è¿è¡ŒTypeScriptç±»å‹æ£€æŸ¥..."
# npm run type-check
# echo "ğŸ’… æ£€æŸ¥ä»£ç æ ¼å¼..."
# npm run format -- --check
# echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
# npm test

echo "âœ… Pre-commitæ£€æŸ¥é€šè¿‡ï¼"
exit 0