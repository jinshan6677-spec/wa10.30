#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🔍 运行pre-commit检查..."

# 运行lint检查（仅检查staged文件）
echo "📝 运行ESLint..."
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx)$' || true)

if [ -n "$STAGED_FILES" ]; then
  npx eslint --max-warnings=-1 $STAGED_FILES
  if [ $? -ne 0 ]; then
    echo "❌ ESLint检查失败（存在errors），请修复错误后重试"
    exit 1
  fi
else
  echo "ℹ️ 没有staged的TypeScript文件需要检查"
fi

# Skip type-check, format and test for now (they check entire project)
# Uncomment these when all files pass
# echo "🔧 运行TypeScript类型检查..."
# npm run type-check
# echo "💅 检查代码格式..."
# npm run format -- --check
# echo "🧪 运行测试..."
# npm test

echo "✅ Pre-commit检查通过！"
exit 0